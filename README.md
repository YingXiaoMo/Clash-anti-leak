# ğŸ¤– Mihomo æ™ºèƒ½æƒé‡æ¨¡å‹è®­ç»ƒä¸è‡ªåŠ¨åŒ–éƒ¨ç½²

æœ¬é¡¹ç›®æ—¨åœ¨åˆ©ç”¨ **LightGBM å›å½’æ¨¡å‹**ï¼ŒåŸºäº **Clash.Meta / Mihomo** äº§ç”Ÿçš„å†å²è¿æ¥æ—¥å¿—æ•°æ®ï¼Œè®­ç»ƒå‡ºèƒ½å¤Ÿé¢„æµ‹ä»£ç†èŠ‚ç‚¹æœ€ä½³æƒé‡çš„æ¨¡å‹ï¼ˆ`Model.bin`ï¼‰ï¼Œå¹¶é€šè¿‡ **GitHub Actions** å®ç°è‡ªåŠ¨åŒ–è®­ç»ƒã€æ„å»ºå’Œéƒ¨ç½²ã€‚

---

## âœ¨ é¡¹ç›®åŠŸèƒ½ä¸€è§ˆ

- **V3 å…¼å®¹**ï¼šæœ€ç»ˆæ¨¡å‹ä½¿ç”¨ `smart-store-creator` åº“è¿›è¡Œ V3 äºŒè¿›åˆ¶ç¼–ç ï¼Œå¯ç›´æ¥è¢« Mihomo å†…æ ¸ä½¿ç”¨ã€‚  
- **Go æºç ç‰¹å¾è§£æ**ï¼šPython è„šæœ¬è‡ªåŠ¨è§£æ Mihomo Go æºç ä¸­å®šä¹‰çš„ç‰¹å¾é¡ºåºï¼Œç¡®ä¿è®­ç»ƒç‰¹å¾ä¸è¿è¡Œæ—¶ä¸€è‡´ã€‚  
- **æ•°æ®æ¸…æ´—ä¸åŠ è½½**ï¼šè‡ªåŠ¨éå†æ•°æ®æ–‡ä»¶ï¼Œæ‰§è¡ŒåŠ è½½ã€ç¼ºå¤±å€¼å¤„ç†å’Œæ¸…æ´—ã€‚  
- **LightGBM æ¨¡å‹è®­ç»ƒ**ï¼šä½¿ç”¨ LightGBM æ¡†æ¶è¿›è¡Œé«˜æ•ˆè®­ç»ƒã€‚  
- **GitHub Actions è‡ªåŠ¨åŒ–**ï¼šè‡ªåŠ¨æ‰§è¡Œå®Œæ•´è®­ç»ƒæµç¨‹ã€‚  
- **æ¨¡å‹äº§ç‰©å‘å¸ƒï¼ˆReleaseï¼‰**ï¼šè®­ç»ƒå®Œæˆåè‡ªåŠ¨å‘å¸ƒ `Model.bin` æ–‡ä»¶åˆ° GitHub Releaseã€‚

---

## âš ï¸ å…³é”®æ“ä½œè­¦å‘Š

### 1. æ•°æ®æ¥æºä¸ Runner æ¸…ç†æœºåˆ¶

- **æ•°æ®æ¥æº**ï¼šæœ¬å·¥ä½œæµä¸å­˜å‚¨æ•°æ®ï¼Œå‡å®šå†å²æ•°æ®ä»å¤–éƒ¨äº‘å­˜å‚¨ï¼ˆå¦‚ Google Cloud Storage æˆ– Google Driveï¼‰ä¸‹è½½åˆ° Runner çš„ `data/` ç›®å½•ã€‚
- **Runner æ¸…ç†æœºåˆ¶**ï¼šå·¥ä½œæµç»“æŸåï¼ŒRunner è™šæ‹Ÿæœºä¼šè¢«é”€æ¯ï¼Œå› æ­¤ `data/` ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚
- **é‡è¦æç¤º**ï¼šâš ï¸ è¯·å‹¿å°†åŸå§‹æ•°æ®ç›´æ¥å­˜å‚¨åœ¨ä»“åº“ä¸­ï¼åŠ¡å¿…ä½¿ç”¨å¤–éƒ¨å¯é å­˜å‚¨æœåŠ¡ã€‚

---

## ğŸ“‚ æ–‡ä»¶ç»“æ„ä¸ä¾èµ–

ä»¥ä¸‹æ–‡ä»¶å’Œç›®å½•å¿…é¡»å­˜åœ¨ï¼š

| è·¯å¾„ | æè¿° | çŠ¶æ€ |
|------|------|------|
| `data/` | å¿…éœ€ã€‚CSV æ•°æ®ä¸‹è½½çš„ä¸´æ—¶ç›®å½• | âœ… å¿…å¡« |
| `models/` | å¿…éœ€ã€‚å­˜æ”¾ç”Ÿæˆçš„ `Model.bin` æ–‡ä»¶ | âœ… å¿…å¡« |
| `Smart/go_transform/transform.go` | Go ç‰¹å¾å®šä¹‰æ–‡ä»¶ï¼Œä¾›è§£æå™¨è¯»å– | âœ… å¿…å¡« |
| `Smart/scripts/train_smart.py` | ä¸»è®­ç»ƒè„šæœ¬ï¼Œè´Ÿè´£è®­ç»ƒä¸ç¼–ç  | âœ… å¿…å¡« |
| `Smart/scripts/go_parser.py` | Go ç‰¹å¾è§£æå·¥å…·è„šæœ¬ | âœ… å¿…å¡« |
| `required_dependencies.txt` | Python ä¾èµ–åˆ—è¡¨ | âœ… å¿…å¡« |
| `.github/workflows/train_and_deploy.yml` | GitHub Actions è‡ªåŠ¨åŒ–å®šä¹‰æ–‡ä»¶ | âœ… å¿…å¡« |

---

## ğŸ› ï¸ æ–°ç”¨æˆ·ä½¿ç”¨æŒ‡å—ï¼šéœ€è¦ä¿®æ”¹çš„å…³é”®ä½ç½®

### 1. æ–‡ä»¶å¤¹åˆ›å»ºå’Œæ•°æ®å‡†å¤‡

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä»¥ä¸‹æ–‡ä»¶å¤¹ï¼š

| æ–‡ä»¶å¤¹ / æ–‡ä»¶ | å†…å®¹è¦æ±‚ |
|----------------|-----------|
| `data/` | åˆ›å»ºç©ºæ–‡ä»¶å¤¹ï¼Œç”¨äºä¸‹è½½æ•°æ® |
| `models/` | åˆ›å»ºç©ºæ–‡ä»¶å¤¹ï¼Œç”¨äºä¿å­˜æ¨¡å‹è¾“å‡º |
| `Smart/go_transform/transform.go` | æ”¾å…¥ Mihomo æºç ä¸­çš„ Go ç‰¹å¾å®šä¹‰æ–‡ä»¶ |

---

### 2. è®­ç»ƒè„šæœ¬ä¿®æ”¹ (`Smart/scripts/train_smart.py`)

| å˜é‡ / ä»£ç æ®µ | å»ºè®®ä¿®æ”¹å†…å®¹ |
|---------------|---------------|
| `DATA_FILE`, `GO_FILE`, `MODEL_FILE` | ä¿®æ”¹è·¯å¾„ï¼Œç¡®ä¿è„šæœ¬èƒ½æ‰¾åˆ°æ­£ç¡®æ–‡ä»¶ä¸è¾“å‡ºä½ç½® |
| `LGBM_PARAMS` | å¯è°ƒæ•´ LightGBM è¶…å‚æ•°ï¼ˆå¦‚ `learning_rate`ï¼‰ |
| `STD_SCALER_FEATURES` / `ROBUST_SCALER_FEATURES` | æŒ‰ç‰¹å¾ç±»å‹è°ƒæ•´æ ‡å‡†åŒ–æ–¹å¼ |

---

### 3. è‡ªåŠ¨åŒ–å·¥ä½œæµä¿®æ”¹ (`.github/workflows/train_and_deploy.yml`)

| é…ç½®é¡¹ | å»ºè®®ä¿®æ”¹å†…å®¹ |
|--------|---------------|
| `on:` | é»˜è®¤æ˜¯ pushã€‚è‹¥éœ€å®šæ—¶è®­ç»ƒï¼Œå¯æ”¹ä¸º  
  ```yaml
  schedule:
    - cron: '0 0 * * *'
  ``` |
| **æ•°æ®ä¸‹è½½æ­¥éª¤** | æ·»åŠ ä»å¤–éƒ¨äº‘å­˜å‚¨ä¸‹è½½ CSV çš„æ­¥éª¤ï¼ˆç¤ºä¾‹è§ä¸‹ï¼‰ |
| `python-version` | ä¿®æ”¹ä¸ºä½ çš„ Python ç‰ˆæœ¬ï¼ˆå¦‚ 3.10 / 3.11ï¼‰ |
| **ä¾èµ–å®‰è£…** | ç¡®ä¿åŒ…å«ï¼š  
  ```bash
  pip install -r required_dependencies.txt
  ``` |
| **Telegram Secretsï¼ˆå¯é€‰ï¼‰** | é…ç½® `TG_BOT_TOKEN` å’Œ `TG_CHAT_ID` ä»¥æ¥æ”¶é€šçŸ¥ |

---

## ğŸš€ æ•°æ®ä¸‹è½½é…ç½®ç¤ºä¾‹ï¼ˆGoogle Cloud Storageï¼‰

å‡è®¾æ•°æ®å­˜å‚¨åœ¨ **Google Cloud Storage (GCS)**ï¼Œå¯åœ¨å·¥ä½œæµä¸­æ·»åŠ å¦‚ä¸‹æ­¥éª¤ï¼š

### 1. é…ç½® GitHub Secrets

| Secret åç§° | å†…å®¹ |
|--------------|------|
| `GCP_SA_KEY` | ä½ çš„ Google æœåŠ¡è´¦æˆ·å¯†é’¥ JSON æ–‡ä»¶å†…å®¹ |

> âš ï¸ æ­¤å¯†é’¥å¿…é¡»æ‹¥æœ‰è®¿é—® GCS å­˜å‚¨æ¡¶çš„æƒé™ã€‚

---

### 2. ä¿®æ”¹å·¥ä½œæµ YAML ç¤ºä¾‹

åœ¨ `.github/workflows/train_and_deploy.yml` çš„ `train` ä»»åŠ¡ä¸­ï¼Œåœ¨ `actions/checkout` ä¹‹åæ·»åŠ ï¼š

```yaml
# 1. è®¤è¯ Google Cloud (ä½¿ç”¨æœåŠ¡è´¦æˆ·å¯†é’¥ JSON)
- name: è®¤è¯ Google Cloud
  uses: google-github-actions/auth@v2
  with:
    credentials_json: ${{ secrets.GCP_SA_KEY }}

# 2. ä» Google Cloud Storage ä¸‹è½½å†å²æ•°æ®
- name: ä» Google Cloud Storage ä¸‹è½½å†å²æ•°æ®
  run: |
    echo "åˆ›å»ºæ•°æ®ç›®å½•..."
    mkdir -p data
    
    # ğŸš¨ æ›¿æ¢ä¸ºä½ çš„å®é™…å­˜å‚¨è·¯å¾„
    gsutil cp gs://your-gcs-bucket-name/smart_data/*.csv ./data/
    
    echo "æ•°æ®ä¸‹è½½å®Œæˆï¼"
